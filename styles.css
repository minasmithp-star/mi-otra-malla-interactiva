:root{
  --bg:#ffffff;
  --sem-bg:#ede6db;
  --sem-border:#9f988e;

  --unlocked:#80aec3;
  --unlocked-border:#457387;

  --approved:#a2b38b;
  --approved-border:#768660;

  --blocked-bg:#eef1f3;
  --blocked-ink:#5d6772;
  --blocked-border:#a9b2ba;

  --planned-ring:#b0855b;
  --planned-bg:#f5efe7;

  --ink:#1c2630;
  --muted:#6b747d;

  --shadow: 0 6px 16px rgba(0,0,0,.07);
  --radius: 18px;
  --radius-sm: 12px;
}

html,body{ height:100%; }
body{
  margin:0;
  font-family:"Caudex", serif;
  color:var(--ink);
  background:var(--bg);
}

/* Top */
.topbar{
  position:sticky; top:0; z-index:5;
  backdrop-filter: blur(6px);
  background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.82));
  border-bottom:1px solid #e7e1d8;
  padding:10px 16px 8px;
}
.topbar h1{ margin:4px 0 8px; font-size:clamp(18px,2.4vw,28px); letter-spacing:.2px; }
.toolbar{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
.legend{ display:flex; gap:10px; flex-wrap:wrap; font-size:12px; }
.legend-item{ display:inline-flex; align-items:center; gap:8px; border-radius:999px; padding:6px 10px; border:1px solid #e1d8cc; background:#fff; }
.legend-item::before{ content:""; width:14px; height:14px; border-radius:4px; display:inline-block; border:2px solid transparent; }
.legend-item.unlocked::before{ background:var(--unlocked); border-color:var(--unlocked-border); }
.legend-item.blocked::before{ background:var(--blocked-bg); border:2px dashed var(--blocked-border); }
.legend-item.passed::before{ background:var(--approved); border-color:var(--approved-border); }
.legend-item.planned::before{ background:var(--planned-bg); border-color:var(--planned-ring); }

.actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.btn{
  font-family:"Caudex", serif; padding:8px 14px; border-radius:999px; border:1px solid var(--unlocked-border);
  background:var(--unlocked); color:#0f2a34; cursor:pointer; box-shadow:var(--shadow);
  transition: transform .15s ease, box-shadow .15s ease, background-color .25s ease, border-color .25s ease;
}
.btn:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.08); }
.btn:active{ transform:translateY(0); }
.btn.btn-outline{ background:#fff; color:var(--ink); border-color:#c9c2b7; }
.hint{ color:var(--muted); display:block; margin-top:10px; }

/* Utilidades */
.utility{
  display:grid; grid-template-columns: 1fr auto auto; gap:16px; align-items:center;
  margin-top:10px;
}
.progress{ display:flex; align-items:center; gap:12px; min-width: 300px; }
.progress .bar{ width: 260px; height: 10px; background:#f1ece4; border:1px solid var(--sem-border); border-radius:999px; overflow:hidden; }
.progress .fill{ display:block; height:100%; background:var(--approved); transition:width .35s ease; }
.progress .label{ font-size:14px; }
.filterbox{ display:flex; align-items:center; gap:8px; }
#filter-state{ font-family:"Caudex", serif; padding:6px 10px; border-radius:999px; border:1px solid var(--sem-border); background:#fff; }
.searchbox{ display:flex; flex-direction:column; gap:6px; justify-self:end; }
#search-input{ font-family:"Caudex", serif; width:320px; max-width:90vw; padding:8px 12px; border-radius:999px; border:1px solid var(--sem-border); background:#fff; }
.search-info{ background:var(--sem-bg); border:1px solid var(--sem-border); border-radius:12px; padding:10px 12px; box-shadow:var(--shadow); max-width:min(520px, 92vw); }

/* Panel (solo resumen global) */
.panel-avance{ margin-top:10px; background:#fff; border:1px solid #e7e1d8; border-radius:14px; padding:10px 12px; }
.panel-avance h3{ margin:4px 0 10px; font-size:16px; }
.grid-avance{ display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.card-metric{ background:var(--sem-bg); border:1px solid var(--sem-border); border-radius:12px; padding:10px 12px; }
.card-metric .title{ font-weight:700; margin-bottom:6px; }
.card-metric .nums{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:6px 8px; font-size:14px; color:#2a2a2a; }
.badge{ display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d9d1c6; background:#fff; font-size:12px; }

/* Main */
#viewport{ position:relative; padding:18px 12px 40px; overflow:auto; }
#malla{ display:grid; grid-auto-flow: column; grid-auto-columns: minmax(280px, 300px); gap:18px; align-items:start; position:relative; }

/* Semestre */
.semestre{ background:var(--sem-bg); border:1px solid var(--sem-border); border-radius:var(--radius); padding:12px; box-shadow:var(--shadow); position:relative; }
.semestre h2{ margin:4px 6px 10px; font-size:18px; font-weight:700; color:#2a2a2a; text-align:center; }
.sem-credits{ position:absolute; right:10px; top:10px; font-size:12px; background:#fff; border:1px solid var(--sem-border); border-radius:999px; padding:2px 8px; }

/* Secciones */
.section-title{ font-weight:700; font-size:14px; margin:10px 4px 2px; color:#2a2a2a; }
.sem-section{ margin-top:6px; }

/* Banner agregar (más pequeño y sin texto extra) */
.add-banner{
  margin:8px 4px 0; padding:6px 10px; border-radius:12px; border:1px dashed var(--sem-border);
  background:#fff; cursor:pointer; display:inline-flex; align-items:center; gap:8px; font-size:0.95em;
}
.add-banner strong{ font-weight:700; }
.add-banner:hover{ background:#faf7f2; }

/* Asignatura */
.ramo{
  position:relative; padding:10px 10px; border-radius:var(--radius-sm); margin:8px 4px;
  line-height:1.35; user-select:none; border:2px solid transparent; cursor:pointer;
  box-shadow:0 1px 0 rgba(0,0,0,0.04);
  transition: transform .12s ease, box-shadow .12s ease, background-color .25s ease, border-color .25s ease, color .25s ease, filter .25s ease;
}

/* NUEVO: layout en dos filas: título y meta (chips) */
.ramo-title{
  font-weight:700; padding-right:4px; word-break:break-word;
}
.ramo-meta{
  margin-top:8px; display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;
}
.meta-left{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.meta-right{ display:flex; align-items:center; gap:6px; }

/* Botones y chips */
.iconbtn{
  font:inherit; line-height:1; border-radius:999px; border:1px solid #c9c2b7; background:#fff;
  padding:2px 6px; cursor:pointer; box-shadow:0 1px 0 rgba(0,0,0,.04);
  transition: transform .12s ease, background-color .2s ease, border-color .2s ease;
}
.iconbtn:hover{ transform:translateY(-1px); }
.credit-chip{
  font-size:12px; background:#fff; border:1px solid var(--sem-border);
  border-radius:999px; padding:2px 8px; cursor:pointer; user-select:none;
}

/* Editor de créditos (banner inline en la tarjeta) */
.credit-editor{
  margin-top:8px; background:#fff; border:1px solid var(--sem-border); border-radius:10px;
  padding:8px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;
}
.credit-editor input{
  width:80px; padding:6px 8px; border:1px solid var(--sem-border); border-radius:8px; font-family:"Caudex", serif;
}

/* Estados */
.ramo.desbloqueado{ background:var(--unlocked); border-color:var(--unlocked-border); }
.ramo.bloqueado{ background:var(--blocked-bg); color:var(--blocked-ink); border:2px dashed var(--blocked-border); cursor:not-allowed; filter:saturate(0.3); }
.ramo.aprobado{ background:var(--approved)!important; color:#12210f; border-color:var(--approved-border)!important; box-shadow: inset 0 0 0 1px rgba(255,255,255,.2), 0 2px 6px rgba(0,0,0,.12); }
.ramo.planeada{ outline:2px solid var(--planned-ring); outline-offset:1px; background:var(--planned-bg); }
.ramo.desbloqueado:not(.aprobado):hover{ transform:scale(1.03); box-shadow:0 10px 20px rgba(0,0,0,.12); }

/* Resaltado dependencias */
.dim .ramo:not(.is-highlight){ filter:grayscale(.35) opacity(.6); }
.ramo.is-highlight{ outline:2px solid var(--unlocked-border); outline-offset:1px; }

/* Tooltip */
.tooltip{
  position:absolute; z-index:3; background:var(--sem-bg); color:var(--ink);
  border:1px solid var(--sem-border); border-radius:12px; box-shadow:var(--shadow);
  padding:10px 12px; max-width:320px; font-size:14px; pointer-events:none;
  opacity:0; transform:translateY(-4px); transition:opacity .18s ease, transform .18s ease;
}
.tooltip.show{ opacity:1; transform:translateY(0); }

/* Modal */
.modal::backdrop{ background:rgba(0,0,0,.25); }
.modal{ border:none; padding:0; background:transparent; }
.modal-card{
  background:#fff; border:1px solid #e7e1d8; border-radius:14px; box-shadow:var(--shadow);
  padding:12px; width:min(560px, 94vw);
}
.modal-card h4{ margin:0 0 8px; }
.modal-card textarea, .modal-card input, .modal-card select{
  width:100%; box-sizing:border-box; font-family:"Caudex", serif; padding:8px 10px;
  border-radius:10px; border:1px solid var(--sem-border); background:#fff;
}
.form-row{ margin:8px 0; display:flex; flex-direction:column; gap:6px; }
.req-search{ width:100%; padding:8px 10px; border:1px solid var(--sem-border); border-radius:10px; margin-bottom:6px; }
.reqs-list label{ display:flex; align-items:center; gap:8px; margin:4px 0; }
.modal-actions{ margin-top:10px; display:flex; gap:8px; justify-content:flex-end; }

@keyframes pulse { 0%{ box-shadow:0 0 0 0 rgba(69,115,135,.55);} 70%{ box-shadow:0 0 0 10px rgba(69,115,135,0);} 100%{ box-shadow:0 0 0 0 rgba(69,115,135,0);} }
.ramo.pulse{ animation:pulse 1s ease-out 2; }

.foot{ padding:14px 16px 24px; color:var(--muted); text-align:center; }
